# random seed of the model
seed: 42

global_step: 0

act_norm_init_samples: 128

reporting:
  num_samples: 1000
  num_samples_per_batch: 1000
  plot_quaternions: [1, 3, 5, 7, 9, 11] 
  plot_oxygens: True
  plot_energy_histograms: True
  report_ess: True
  report_likelihood: false 
  save_model: false
  save_samples: false
  save_statistics: false

model:

  # set if model is trained with warm start
  pretrained_model_path: null # runs/2022-12-13_19:18:20/training_stage_0/epoch_1/model.eqx 

  # shape of the auxiliary variables
  auxiliary_shape: [16, 3]

  # definition of the flow model
  flow:
    # coupling layers
    couplings:
      - num_repetitions: 1
        auxiliary_update:
          seq_len: 16
          activation: gelu
          num_pos: 3
          num_dims: 64
          expansion_factor: 2
          num_blocks: 1
          num_low_rank: 0
          low_rank_regularizer: 0.
          transform: gated
        position_update:
          seq_len: 16
          activation: gelu
          num_pos: 3
          num_dims: 64
          expansion_factor: 2
          num_blocks: 1
          num_low_rank: 0
          low_rank_regularizer: 0.
          transform: gated
        quaternion_update:
          seq_len: 16
          activation: gelu
          expansion_factor: 2
          num_blocks: 1
        act_norm: false
      
  base:
    path: "/group/ag_cmb/scratch/minvernizzi/so3-flow/ice_MDdata"
    num_molecules: 16
    temperature: 250
    ice_type: XI
    water_type: tip4pew
    recompute_forces: false
    store_forces: false
    forces_path: null
    fixed_box: true

    softcore_cutoff: null
    softcore_potential: "linear"
    softcore_slope: 2.

  target:
    path: "/group/ag_cmb/scratch/minvernizzi/so3-flow/ice_MDdata"
    num_molecules: 16
    temperature: 100
    ice_type: XI
    water_type: tip4pew
    recompute_forces: false
    store_forces: false
    forces_path: null
    fixed_box: true

    softcore_cutoff: null
    softcore_potential: "linear"
    softcore_slope: 2.

# training definition
train:

  # first stage: only likelihood
  - num_epochs: 2
    num_iters_per_epoch: 1000

    init_learning_rate: 1e-2
    target_learning_rate: 1e-3

    weight_nll: 0.

    weight_fm_model: 0.
    fm_model_perturbation_noise: 0
    weight_fm_target: 0
    fm_target_perturbation_noise: 0
    fm_ignore_charge_site: true

    weight_fe: 1.

    weight_vg_model: 0.
    weight_vg_target: 0.
  
    num_samples: 32

    use_grad_clipping: false
    grad_clipping_ratio: 1.

    apply_if_finite_trials: 100